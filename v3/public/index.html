<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBroker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="title-section">
                    <h1>SmartBroker</h1>
                    <p>Intelligent Company Compatibility Research</p>
                </div>
                <div class="utility-links">
                    <a href="https://docs.google.com/forms/d/1kQfFdDBnuRQEIqSNfWFGGkY490eEyP-DJq3NKK81wyw/viewform" target="_blank" class="bug-report-link">
                        üêõ Report Bug
                    </a>
                </div>
            </div>
        </div>
        
        <div class="main-window">
            <div class="tabs">
                <button class="tab active" data-tab="research">Research</button>
                <button class="tab" data-tab="output">Output</button>
                <button class="tab" data-tab="options">Options</button>
                <button class="tab" data-tab="apikeys">API Keys</button>
                <button class="tab" data-tab="instructions">Instructions</button>
            </div>
            
            <!-- Research Tab -->
            <div class="tab-content active" id="research-tab">
                <div class="research-controls">
                    <div class="file-upload">
                        <label for="csv-upload">Upload Company Data (CSV):</label>
                        <input type="file" id="csv-upload" accept=".csv">
                        <div class="file-info">No file selected</div>
                        <button class="btn btn-secondary" id="import-btn">üì§ Import</button>
                    </div>
                    
                    <div class="range-input">
                        <label for="company-range">Company Range:</label>
                        <input type="text" id="company-range" placeholder="e.g., 1-10 or 50-100" value="1-50">
                    </div>
                    
                    <div class="criteria-selection">
                        <h3>Research Criteria</h3>
                        <div class="criteria-grid" id="criteria-grid">
                            <!-- Criteria checkboxes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="research-actions">
                    <button class="btn btn-start" id="start-btn">‚ñ∂ Start Research</button>
                    <button class="btn btn-stop" id="stop-btn" style="display: none;">‚è∏ Stop Research</button>
                    <button class="btn btn-secondary" id="export-btn">üìä Export Results</button>
                </div>
                
                <div class="cost-summary" id="cost-summary">
                    <div class="cost-item">
                        <span class="cost-label">Total Spent:</span>
                        <span class="cost-value" id="total-cost">$0.00</span>
                    </div>
                    <div class="cost-item">
                        <span class="cost-label">Average per Company:</span>
                        <span class="cost-value" id="average-cost">$0.00</span>
                    </div>
                    <div class="cost-item">
                        <span class="cost-label">Average per Query:</span>
                        <span class="cost-value" id="average-query-cost">$0.00</span>
                    </div>
                    <div class="cost-item">
                        <span class="cost-label">Queries Researched:</span>
                        <span class="cost-value" id="queries-researched">0</span>
                    </div>
                    <div class="cost-item">
                        <span class="cost-label">Companies Researched:</span>
                        <span class="cost-value" id="companies-researched">0</span>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="progress-table">
                        <thead>
                            <tr>
                                <th>Company Name</th>
                                <th>Placeholder 1</th>
                                <th>Placeholder 2</th>
                                <th>Placeholder 3</th>
                                <th>Placeholder 4</th>
                                <th>Placeholder 5</th>
                                <th>Placeholder 6</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table-body">
                            <!-- Table rows will be populated dynamically by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Output Tab -->
            <div class="tab-content" id="output-tab">
                <div class="output-controls">
                    <h3>Output Filters</h3>
                    <div class="output-checkboxes">
                        <div class="output-item">
                            <input type="checkbox" id="system-prompt" checked>
                            <label for="system-prompt">System Prompt</label>
                        </div>
                        <div class="output-item">
                            <input type="checkbox" id="criterion-prompt-filter" checked>
                            <label for="criterion-prompt-filter">Criterion Prompt</label>
                        </div>
                        <div class="output-item">
                            <input type="checkbox" id="tool-response" checked>
                            <label for="tool-response">Tool Response</label>
                        </div>
                        <div class="output-item">
                            <input type="checkbox" id="claude-tool-request" checked>
                            <label for="claude-tool-request">Claude Tool Request</label>
                        </div>
                        <div class="output-item">
                            <input type="checkbox" id="claude-analysis" checked>
                            <label for="claude-analysis">Claude Analysis</label>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="clear-output-btn" style="margin-top: 10px;">üóëÔ∏è Clear Output</button>
                </div>
                
                <div class="terminal" id="terminal">
                    <!-- Messages will be dynamically added here -->
                </div>
            </div>
            
            <!-- Options Tab -->
            <div class="tab-content" id="options-tab">
                <div class="options-grid">
                    <div class="options-section">
                        <h3>Research Templates</h3>
                        <div class="form-group">
                            <label>Current Template:</label>
                            <select id="template-select">
                                <!-- Populated dynamically from database -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>System Prompt:</label>
                            <textarea id="system-prompt-textarea" placeholder="Enter the system prompt for Claude..." rows="8"></textarea>
                        </div>
                        <button class="btn" id="save-template-btn">Save Template</button>
                        <button class="btn btn-secondary" id="delete-template-btn">Delete Template</button>
                    </div>
                    
                    <div class="options-section">
                        <h3>Research Criteria</h3>
                        <div class="form-group">
                            <label>Select Criterion:</label>
                            <select id="criterion-select">
                                <!-- Populated dynamically from current template -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Criterion Name:</label>
                            <input type="text" id="criterion-name" placeholder="Enter criterion name">
                        </div>
                        <div class="form-group">
                            <label>Order (in research sequence):</label>
                            <input type="number" id="criterion-order" min="1" max="20" value="1">
                        </div>
                        <div class="form-group">
                            <label>Research Prompt:</label>
                            <textarea id="criterion-prompt" placeholder="Describe what this criterion should research..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Perplexity Pre-Query (optional):</label>
                            <input type="text" id="perplexity-query" placeholder="e.g., 'CompanyName products services business model'">
                        </div>
                        <div class="form-group">
                            <label>Answer Format:</label>
                            <select id="answer-format">
                                <option value="string">String</option>
                                <option value="yes-no">Yes/No</option>
                                <option value="number">Number</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="qualifying-criterion">
                                <label for="qualifying-criterion">Qualifying Criterion (negative result excludes company)</label>
                            </div>
                        </div>
                        <button class="btn" id="update-criterion-btn">Update Criterion</button>
                        <button class="btn btn-secondary" id="delete-criterion-btn">Delete Criterion</button>
                        <button class="btn btn-warning" id="delete-research-btn">Delete Research Results</button>
                    </div>
                    
                    <div class="options-section">
                        <h3>Export Options</h3>
                        <div class="form-group">
                            <label>Output Format:</label>
                            <select id="export-format">
                                <option value="csv">CSV</option>
                                <option value="excel" disabled>Excel (Coming Soon)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data Columns:</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="export-company-name" checked disabled>
                                    <label for="export-company-name">Company Name</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="export-website" checked>
                                    <label for="export-website">Website</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="export-city" checked>
                                    <label for="export-city">City</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="export-state" checked>
                                    <label for="export-state">State</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="export-show-eliminated">
                                    <label for="export-show-eliminated">Show Eliminated Companies</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API Keys Tab -->
            <div class="tab-content" id="apikeys-tab">
                <div class="options-section">
                    <h3>API Configuration</h3>
                    <p class="api-keys-warning">
                        ‚ö†Ô∏è API keys are stored as environment variables for security. 
                        Keys are never displayed after saving.
                    </p>
                    
                    <div class="api-keys-status" id="api-keys-status">
                        <div class="api-key-status" id="anthropic-status">
                            <span class="status-icon">‚ö™</span>
                            <span class="status-label">Anthropic (Claude):</span>
                            <span class="status-text">Not configured</span>
                        </div>
                        <div class="api-key-status" id="perplexity-status">
                            <span class="status-icon">‚ö™</span>
                            <span class="status-label">Perplexity:</span>
                            <span class="status-text">Not configured</span>
                        </div>
                        <div class="api-key-status" id="phantombuster-status">
                            <span class="status-icon">‚ö™</span>
                            <span class="status-label">PhantomBuster:</span>
                            <span class="status-text">Not configured</span>
                        </div>
                        <div class="api-key-status" id="linkedin-status">
                            <span class="status-icon">‚ö™</span>
                            <span class="status-label">LinkedIn Cookie:</span>
                            <span class="status-text">Not configured</span>
                        </div>
                    </div>

                    <form id="api-keys-form" class="api-keys-form">
                        <div class="form-group">
                            <label for="anthropic-key">Anthropic API Key:</label>
                            <input type="password" id="anthropic-key" placeholder="sk-ant-...">
                            <small>For Claude AI research analysis</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="perplexity-key">Perplexity API Key:</label>
                            <input type="password" id="perplexity-key" placeholder="pplx-...">
                            <small>For web search and information gathering</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="phantombuster-key">PhantomBuster API Key:</label>
                            <input type="password" id="phantombuster-key" placeholder="Your PhantomBuster API key">
                            <small>For LinkedIn profile scraping</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="linkedin-cookie">LinkedIn Session Cookie:</label>
                            <input type="password" id="linkedin-cookie" placeholder="Your LinkedIn li_at cookie">
                            <small>Required for PhantomBuster LinkedIn access</small>
                        </div>
                        
                        <div class="api-keys-actions">
                            <button type="button" class="btn btn-warning" id="save-keys-btn">üíæ Save Keys</button>
                            <button type="button" class="btn btn-secondary" id="clear-form-btn">üóëÔ∏è Clear Form</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Instructions Tab -->
            <div class="tab-content" id="instructions-tab">
                <div class="instructions-content">
                    <!-- Instructions will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- CSV Import Services -->
    <script src="js/services/CSVValidator.js"></script>
    <script src="js/services/Logger.js"></script>
    <script src="js/services/ErrorHandler.js"></script>
    <script src="js/services/NotificationService.js"></script>
    <script src="js/services/CSVImportService.js"></script>
    
    <!-- Main Application -->
    <script src="js/csv-exporter.js"></script>
    <script src="js/main_gui.js"></script>
    <script src="js/research_gui.js"></script>
    <script src="js/output_gui.js"></script>
    <script src="js/options_gui.js"></script>
    <script src="js/api_keys_gui.js"></script>
    <script src="js/instructions_gui.js"></script>
</body>
</html>